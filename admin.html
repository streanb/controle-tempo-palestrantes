<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Admin - Controle de Tempos</title>
<style>
  body { font-family: Arial; padding: 20px; background: #f0f0f0; color: #222; }
  h1, h2 { margin-top:0; }
  #grade { display:grid; grid-template-columns: repeat(auto-fit, minmax(250px,1fr)); gap:16px; margin-top:12px; }
  .cartao { background:#fff; border-radius:12px; padding:16px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
  input, button { margin-top:8px; padding:6px; font-size:14px; }
  .botoes, .cores { display:flex; flex-wrap:wrap; gap:4px; margin-top:8px; }
  .cores button { width:24px; height:24px; border:none; cursor:pointer; border-radius:4px; }
  .botoes button { flex:1; }
</style>
</head>
<body>

<!-- TÃ­tulo editÃ¡vel -->
<h1 id="titulo-principal">Controle de Tempos Assembleia de Freguesia</h1>
<div style="margin-bottom:12px;">
  <input type="text" id="input-titulo" placeholder="Digite novo tÃ­tulo">
  <button onclick="atualizarTitulo()">Atualizar TÃ­tulo</button>
</div>

<h2>AdministraÃ§Ã£o de Tempos</h2>
<button onclick="adicionarPartido()">+ Adicionar Partido</button>
<button onclick="resetarTudo()">ðŸ”„ Reset Tudo</button>
<div id="grade"></div>

<script type="module">
import { db } from './firebase-config.js';
import { ref, set, remove, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

let partidos = [];
const estados = {};
const grade = document.getElementById('grade');

// FunÃ§Ã£o para formatar tempo
function formatarTempo(seg){ 
  const m=Math.floor(seg/60).toString().padStart(2,'0'); 
  const s=(seg%60).toString().padStart(2,'0'); 
  return `${m}:${s}`; 
}

// Criar interface dos cartÃµes
function criarInterface(){
  grade.innerHTML='';
  partidos.forEach((nome,i)=>{
    if(!estados[nome]) estados[nome]={tempo:0,tempoInicial:0,rodando:false,timer:null};
    const div=document.createElement('div');
    div.className='cartao';
    div.id='cartao-'+nome;
    div.innerHTML=`
      <input type="text" id="nome-${i}" value="${nome}" onchange="salvarNome(${i})" />
      <div class="botoes">
        <input type="number" id="min-${i}" placeholder="Minutos" min="0">
        <button onclick="setTempo(${i})">Definir</button>
        <button onclick="removerPartido(${i})">Remover</button>
      </div>
      <div class="botoes">
  <button onclick="play(${i})">
    <img src="https://cdn-icons-png.flaticon.com/512/2468/2468801.png" alt="Play" width="24" height="24">
  </button>
  <button onclick="pause(${i})">
    <img src="https://cdn-icons-png.flaticon.com/512/11880/11880231.png" alt="Pause" width="24" height="24">
  </button>
  <button onclick="resetTempo(${i})">
    <img src="https://cdn-icons-png.flaticon.com/512/9899/9899316.png" alt="Reset" width="24" height="24">
  </button>
</div>
      <div class="tempo-display" id="tempo-${i}" style="margin-top:10px;font-weight:bold;">${formatarTempo(estados[nome].tempo)}</div>
      <div class="cores">
        <button style="background:#007BFF;" onclick="mudarCor('${nome}','#007BFF')"></button>
        <button style="background:#28a745;" onclick="mudarCor('${nome}','#28a745')"></button>
        <button style="background:#dc3545;" onclick="mudarCor('${nome}','#dc3545')"></button>
        <button style="background:#ffc107;" onclick="mudarCor('${nome}','#ffc107')"></button>
        <button style="background:#FF00FF;" onclick="mudarCor('${nome}','#FF00FF')"></button>
        <button style="background:#00FFFF;" onclick="mudarCor('${nome}','#00FFFF')"></button>
        <button style="background:#FFA500;" onclick="mudarCor('${nome}','#FFA500')"></button>
        <button style="background:#800080;" onclick="mudarCor('${nome}','#800080')"></button>
        <button style="background:#008000;" onclick="mudarCor('${nome}','#008000')"></button>
        <button style="background:#FFC0CB;" onclick="mudarCor('${nome}','#FFC0CB')"></button>
        <button style="background:#808080;" onclick="mudarCor('${nome}','#808080')"></button>
        <button style="background:#000000;" onclick="mudarCor('${nome}','#000000')"></button>
        <button style="background:#0E0ABF;" onclick="mudarCor('${nome}','#0E0ABF')"></button>
      </div>
    `;
    grade.appendChild(div);
  });
}

// FunÃ§Ãµes de tempo
function atualizarFirebase(nome){
  set(ref(db,'tempos/'+nome),{tempoRestante:estados[nome].tempo,rodando:estados[nome].rodando});
  set(ref(db,'nomes/'+nome),nome);
}

// FunÃ§Ãµes globais
window.salvarNome=function(i){
  const novo=document.getElementById(`nome-${i}`).value.trim();
  const antigo=partidos[i];
  if(!novo){ alert('Nome vazio!'); return; }
  partidos[i]=novo;
  estados[novo]=estados[antigo];
  delete estados[antigo];
  remove(ref(db,'nomes/'+antigo));
  set(ref(db,'nomes/'+novo),novo);
  criarInterface();
}

window.setTempo=function(i){
  const nome=partidos[i];
  const min=parseInt(document.getElementById(`min-${i}`).value)||0;
  estados[nome].tempoInicial=min*60;
  estados[nome].tempo=estados[nome].tempoInicial;
  estados[nome].rodando=false;
  atualizarFirebase(nome);
  document.getElementById(`tempo-${i}`).textContent=formatarTempo(estados[nome].tempo);
}

window.play=function(i){
  const nome=partidos[i];
  if(estados[nome].rodando || estados[nome].tempo<=0) return;
  estados[nome].rodando=true;
  atualizarFirebase(nome);
  estados[nome].timer=setInterval(()=>{
    if(estados[nome].tempo>0){
      estados[nome].tempo--;
      atualizarFirebase(nome);
      document.getElementById(`tempo-${i}`).textContent=formatarTempo(estados[nome].tempo);
    } else {
      clearInterval(estados[nome].timer);
      estados[nome].rodando=false;
      atualizarFirebase(nome);
    }
  },1000);
}

window.pause=function(i){
  const nome=partidos[i];
  estados[nome].rodando=false;
  clearInterval(estados[nome].timer);
  atualizarFirebase(nome);
}

window.resetTempo=function(i){
  const nome=partidos[i];
  estados[nome].rodando=false;
  clearInterval(estados[nome].timer);
  estados[nome].tempo=estados[nome].tempoInicial||0;
  atualizarFirebase(nome);
  document.getElementById(`tempo-${i}`).textContent=formatarTempo(estados[nome].tempo);
}

window.adicionarPartido=function(){
  const nome=`Partido ${partidos.length+1}`;
  partidos.push(nome);
  estados[nome]={tempo:0,tempoInicial:0,rodando:false,timer:null};
  set(ref(db,'nomes/'+nome),nome);
  criarInterface();
}

window.removerPartido=function(i){
  const nome=partidos[i];
  clearInterval(estados[nome].timer);
  remove(ref(db,'tempos/'+nome));
  remove(ref(db,'nomes/'+nome));
  remove(ref(db,'cores/'+nome));
  partidos.splice(i,1);
  delete estados[nome];
  criarInterface();
}

window.resetarTudo=function(){
  if(!confirm("Confirma limpar todos os tempos?")) return;
  remove(ref(db,'tempos'));
  remove(ref(db,'nomes'));
  remove(ref(db,'cores'));
  partidos.forEach(n=>clearInterval(estados[n].timer));
  partidos=[]; for(const k in estados) delete estados[k];
  criarInterface();
}

// FunÃ§Ã£o de cores
window.mudarCor=function(nome,cor){
  set(ref(db,'cores/'+nome),cor);
}

// ---------------- TÃTULO EDITÃVEL ----------------
const h1Titulo = document.getElementById('titulo-principal');
const inputTitulo = document.getElementById('input-titulo');
const tituloRef = ref(db, 'titulo');

// Puxar tÃ­tulo do Firebase ao iniciar
onValue(tituloRef, snapshot => {
  const valor = snapshot.val();
  if (valor) {
    h1Titulo.textContent = valor;
    inputTitulo.value = valor;
  }
});

// FunÃ§Ã£o para atualizar o tÃ­tulo
window.atualizarTitulo = () => {
  const novoTitulo = inputTitulo.value.trim();
  if (!novoTitulo) return alert("O tÃ­tulo nÃ£o pode ficar vazio!");
  set(tituloRef, novoTitulo);
  h1Titulo.textContent = novoTitulo;
}

// InicializaÃ§Ã£o
partidos=['Partido 1','Partido 2','Partido 3'];
partidos.forEach(n=>estados[n]={tempo:0,tempoInicial:0,rodando:false,timer:null});
criarInterface();

</script>
</body>
</html>
