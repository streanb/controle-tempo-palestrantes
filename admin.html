<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Controle de Tempo - Admin</title>
</head>
<body>
  <h1>Controle de Tempo - Admin</h1>
  <div id="controls"></div>

  <script type="module">
    import { db } from './firebase-config.js';
    import { ref, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const container = document.getElementById('controls');

    for (let i = 1; i <= 5; i++) {
      const div = document.createElement('div');
      div.innerHTML = `
        <h3>Palestrante ${i}</h3>
        <input type="number" id="input-${i}" placeholder="Minutos">
        <button onclick="start(${i})">Iniciar</button>
        <button onclick="parar(${i})">Parar</button>
        <span id="timer-${i}">00:00</span>
      `;
      container.appendChild(div);
    }

    const intervalos = {};

    window.start = function (id) {
      const minutos = parseInt(document.getElementById(`input-${id}`).value);
      const duracao = minutos * 60;
      const inicio = Date.now();

      set(ref(db, `palestrantes/${id}`), {
        startTime: inicio,
        duration: duracao
      });

      atualizarTimer(id, inicio, duracao);
      intervalos[id] = setInterval(() => {
        atualizarTimer(id, inicio, duracao);
      }, 1000);
    }

    window.parar = function (id) {
      clearInterval(intervalos[id]);
      set(ref(db, `palestrantes/${id}`), {
        startTime: 0,
        duration: 0
      });
      document.getElementById(`timer-${id}`).textContent = '00:00';
    }

    function atualizarTimer(id, inicio, duracao) {
      const agora = Date.now();
      const restante = duracao - Math.floor((agora - inicio) / 1000);
      const min = String(Math.floor(restante / 60)).padStart(2, '0');
      const seg = String(restante % 60).padStart(2, '0');
      document.getElementById(`timer-${id}`).textContent = `${min}:${seg}`;
    }
  </script>
</body>
</html>
