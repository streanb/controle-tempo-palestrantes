<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Tempos dos Palestrantes (ao vivo)</title>
</head>
<body>
  <h1>Tempos dos Palestrantes (ao vivo)</h1>
  <div id="tempos"></div>

  <script type="module">
    import { db } from './firebase-config.js';
    import { ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const container = document.getElementById('tempos');

    for (let i = 1; i <= 5; i++) {
      const div = document.createElement('div');
      div.innerHTML = `<h3>Palestrante ${i}: <span id="tempo-${i}">00:00</span></h3>`;
      container.appendChild(div);

      const palestraRef = ref(db, `palestrantes/${i}`);
      onValue(palestraRef, (snapshot) => {
        const data = snapshot.val();
        if (!data || data.startTime === 0) {
          document.getElementById(`tempo-${i}`).textContent = '00:00';
          return;
        }

        const { startTime, duration } = data;
        atualizar(id, startTime, duration);

        if (window[`int${i}`]) clearInterval(window[`int${i}`]);
        window[`int${i}`] = setInterval(() => {
          atualizar(i, startTime, duration);
        }, 1000);
      });
    }

    function atualizar(id, inicio, duracao) {
      const agora = Date.now();
      const restante = duracao - Math.floor((agora - inicio) / 1000);
      const min = String(Math.max(0, Math.floor(restante / 60))).padStart(2, '0');
      const seg = String(Math.max(0, restante % 60)).padStart(2, '0');
      document.getElementById(`tempo-${id}`).textContent = `${min}:${seg}`;
    }
  </script>
</body>
</html>
